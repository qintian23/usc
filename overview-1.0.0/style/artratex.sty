%---------------------------------------------------------------------------%
%->> Identification
%---------------------------------------------------------------------------%
\NeedsTeXFormat{LaTeX2e}%
\ProvidesPackage{artratex}[2014/10/01 v1.0 LaTeX macros package]%
%---------------------------------------------------------------------------%
%->> Declare options
%---------------------------------------------------------------------------%
\RequirePackage{etoolbox}% 编程工具箱
\newcommand{\artxifstreq}{\expandafter\ifstrequal\expandafter}% 扩展控制
% -
% -> 平台字体集 <windows>, <mac>, <adobe>, <none>, <times>, <others>
% -
% - 获取用户指定的字体集值或根据操作系统类型自动设置
\RequirePackage{expl3}% LaTeX3 编程环境
\ExplSyntaxOn%
\providecommand{\g__ctex_fontset_tl}{}% 平台字体集状态变量
\edef\artxfontset{\g__ctex_fontset_tl}% 扩展平台字体集状态变量
\ExplSyntaxOff%
% - 根据 fontset 的值指定字体集
\newif\ifartx@windows \artx@windowsfalse
\newif\ifartx@mac \artx@macfalse
\newif\ifartx@adobe \artx@adobefalse
\newif\ifartx@none \artx@nonefalse
\newif\ifartx@times \artx@timesfalse
\newif\ifartx@others \artx@othersfalse
\artxifstreq{\artxfontset}{windows}{\artx@windowstrue\artx@timestrue}{%
\artxifstreq{\artxfontset}{mac}{\artx@mactrue\artx@timestrue}{%
\artxifstreq{\artxfontset}{adobe}{\artx@adobetrue\artx@timestrue}{%
\artxifstreq{\artxfontset}{none}{\artx@nonetrue\artx@timestrue}{%
\artx@otherstrue\artx@timesfalse}}}}
% -
% -> LaTeX 引擎 <pdflatex>, <lualatex>, <xelatex>
% -
\newif\ifartx@pdftex \artx@pdftexfalse
\newif\ifartx@luatex \artx@luatexfalse
\newif\ifartx@xetex \artx@xetexfalse
\RequirePackage{ifxetex,ifluatex}% LaTeX 引擎检测
\ifxetex%
    \artx@xetextrue
    \RequirePackage{xeCJK}% 支持调用系统字体
\else\ifluatex%
    \artx@luatextrue
\else%
    \artx@pdftextrue
\fi\fi%
% -
% -> 参考书目引擎 <bibtex>, <biber>
% -
\newif\ifartx@bibtex \artx@bibtextrue
\newif\ifartx@biber \artx@biberfalse
\def\artxbib{bibtex}
\DeclareOption{bibtex}{%
    \artx@bibtextrue
    \artx@biberfalse
    \def\artxbib{bibtex}
}
\DeclareOption{biber}{%
    \artx@bibtexfalse
    \artx@bibertrue
    \def\artxbib{biber}
}
% -
% -> 引用和参考风格
% -
\newif\ifartx@numbers \artx@numberstrue
\newif\ifartx@super \artx@superfalse
\newif\ifartx@authoryear \artx@authoryearfalse
\newif\ifartx@alpha \artx@alphafalse
\DeclareOption{numbers}{%
    \artx@numberstrue
    \artx@superfalse
    \artx@authoryearfalse
    \artx@alphafalse
}
\DeclareOption{super}{%
    \artx@numberstrue
    \artx@supertrue
    \artx@authoryearfalse
    \artx@alphafalse
}
\DeclareOption{authoryear}{%
    \artx@numbersfalse
    \artx@superfalse
    \artx@authoryeartrue
    \artx@alphafalse
}
\DeclareOption{alpha}{%
    \artx@numbersfalse
    \artx@superfalse
    \artx@authoryearfalse
    \artx@alphatrue
}
% -
% -> 页面布局重新配置
% -
\newif\ifartx@geometry \artx@geometryfalse
\DeclareOption{geometry}{%
    \artx@geometrytrue
}
% -
% -> 横向布局支持
% -
\newif\ifartx@lscape \artx@lscapefalse
\DeclareOption{lscape}{%
    \artx@lscapetrue
}
% -
% -> 页眉和页脚
% -
\newif\ifartx@xhf \artx@xhftrue
\DeclareOption{xhf}{%
    \artx@xhffalse
}
% -
% -> 颜色支持
% -
\newif\ifartx@color \artx@colorfalse
\DeclareOption{color}{%
    \artx@colortrue
}
\newif\ifartx@xlink \artx@xlinkfalse
\DeclareOption{xlink}{%
    \artx@xlinktrue
}
% -
% -> 页面背景
% -
\newif\ifartx@background \artx@backgroundfalse
\DeclareOption{background}{%
    \artx@colortrue
    \artx@backgroundtrue
}
% -
% -> 复杂图表支持
% -
\newif\ifartx@tikz \artx@tikzfalse
\DeclareOption{tikz}{%
    \artx@colortrue
    \artx@tikztrue
}
% -
% -> 复杂表支持
% -
\newif\ifartx@table \artx@tablefalse
\DeclareOption{table}{%
    \artx@tabletrue
}
% -
% -> 增强列表
% -
\newif\ifartx@list \artx@listfalse
\DeclareOption{list}{%
    \artx@colortrue
    \artx@listtrue
}
% -
% -> 额外的数学支持
% -
\newif\ifartx@math \artx@mathfalse
\DeclareOption{math}{%
    \artx@mathtrue
}
% -
% -> 处理未实现的选项
% -
\DeclareOption*{%
    \PackageWarning{artratex}{Unknown option '\CurrentOption'}%
}
% -
% -> 终止所有选项处理
% -
\ProcessOptions\relax%
% -------------------------------------------------- --------------%
% ->> 宏包
% -------------------------------------------------- --------------%
% -
% -> 检测类和计数器
% -
\newcommand*{\artxifcnt}[1]{% check if counter exists
    \ifcsname c@#1\endcsname%
        \expandafter\@firstoftwo%
    \else%
        \expandafter\@secondoftwo%
    \fi
}
\artxifcnt{chapter}{\def\artxmaincnt{chapter}}{\def\artxmaincnt{section}}%
% -
% -> 命名项目
% -
\providecommand{\nomenclatureitem}[3][ ]{%
    \noindent\makebox[0.15\textwidth][l]{#2}{{#3}\hfill{#1}}\par
}
% -
% -> 添加目录和书签链接的宏
% -
\newcommand{\intotocnostar}[3]{% [<\chapter|...>,<*>,<title>][example: \intotoc\chapter*{Nomenclature}]
    \edef\artxmark{\expandafter\@gobble\string#1}% get the string 'cmd' after '\' in a command '\cmd'
    #1#2{% excute command
        \phantomsection% create bookmark link
        \addcontentsline{toc}{\artxmark}{#3}% add content #3 to toc as #1
        #3%
    }
    \artxifstreq{\artxmark}{chapter}{%
        \markboth{\MakeUppercase{#3}}{}% set left mark
    }{%
        \markright{\MakeUppercase{#3}}% set right mark
    }
}
\newcommand{\intotocstar}[3][\artxmaincnt]{% [<chapter|...>,<extra commands>,<title>][example: \intotoc*{\cleardoublepage}{Abstract}]
    #2% excute command
    \phantomsection% create bookmark link
    \addcontentsline{toc}{#1}{#3}% add content #3 to toc as #1
    \artxifstreq{#1}{chapter}{%
        \markboth{\MakeUppercase{#3}}{}% set left mark
    }{%
        \markright{\MakeUppercase{#3}}% set right mark
    }
}
\newcommand{\intotoc}{\@ifstar{\intotocstar}{\intotocnostar}}% swap starred and non-starred versions
\newcommand{\intobmknostar}[4][0]{% [<level>,<\chapter|...>,<*>,<title>] [example: \intobmk\chapter*{Abstract}]
    \edef\artxmark{\expandafter\@gobble\string#2}% get the string 'cmd' after '\' in a command '\cmd'
    #2#3{% excute command
        \phantomsection% create bookmark link
        \Hy@writebookmark% write bookmark
        {}%
        {#4}%
        {\@currentHref}%
        {#1}%
        {toc}%
        #4%
    }%
    \artxifstreq{\artxmark}{chapter}{%
        \markboth{\MakeUppercase{#4}}{}% set left mark
    }{%
        \markright{\MakeUppercase{#4}}% set right mark
    }
}
\newcommand{\intobmkstar}[3][0]{% [<level>,<extra commands>,<title>] [example: \intobmk*{\cleardoublepage}{\contentsname}]
    #2% excute command
    \phantomsection% create bookmark link
    \Hy@writebookmark% write bookmark
    {}%
    {#3}%
    {\@currentHref}%
    {#1}%
    {toc}%
    \artxifstreq{#1}{0}{%
        \markboth{\MakeUppercase{#3}}{}% set left mark
    }{%
        \markright{\MakeUppercase{#3}}% set right mark
    }
}
\newcommand{\intobmk}{\@ifstar{\intobmkstar}{\intobmknostar}}% swap starred and non-starred versions
%\newcommand{\rmlbk}[1]{\begingroup\def\\{\relax\ifhmode\unskip\fi\space\ignorespaces}#1\endgroup}% remove line breaks 
% -------------------------------------------------- --------------%
% ->> 需要的包
% -------------------------------------------------- --------------%
% -
% -> 数学包
% -
\RequirePackage{amsmath,amsthm,amssymb}% math structures, theorems, and extended symbols
\theoremstyle{plain}% for theorems, lemmas, propositions, etc
\providecommand{\theoremname}{Theorem}%
\newtheorem{theorem}{\theoremname}[\artxmaincnt]
\providecommand{\axiomname}{Axiom}%
\newtheorem{axiom}[theorem]{\axiomname}
\providecommand{\lemmaname}{Lemma}%
\newtheorem{lemma}[theorem]{\lemmaname}
\providecommand{\corollaryname}{Corollary}%
\newtheorem{corollary}[theorem]{\corollaryname}
\providecommand{\assertionname}{Assertion}%
\newtheorem{assertion}[theorem]{\assertionname}
\providecommand{\propositionname}{Proposition}%
\newtheorem{proposition}[theorem]{\propositionname}
\providecommand{\conjecturename}{Conjecture}%
\newtheorem{conjecture}[theorem]{\conjecturename}
\theoremstyle{definition}% for definitions and examples
\providecommand{\definitionname}{Definition}%
\newtheorem{definition}{\definitionname}[\artxmaincnt]
\providecommand{\examplename}{Example}%
\newtheorem{example}{\examplename}[\artxmaincnt]
\theoremstyle{remark}% for remarks and notes
\providecommand{\remarkname}{Remark}%
\newtheorem*{remark}{\remarkname}

\ifartx@math% extra math packages
    \RequirePackage{mathtools}% extension to amsmath
\fi
% -
% -> 语言设置
% -
\def\artx@fontdir{./Font/}% extra font location
\ifartx@pdftex% <pdflatex> call font packages
    \RequirePackage[utf8]{inputenc}% set input encoding, document must use utf-8 encoding
    \RequirePackage[T1]{fontenc}% set font encoding to enable modern font encoding
    %- Text font: English <default: computer modern|others: font packages>
    \RequirePackage{newtxtext}% main font, <times font: newtxtext|others: palatino>
    %- Math font: <default: computer modern|others: font packages>
    \RequirePackage[cmintegrals]{newtxmath}% times font, load after amsmath and newtxtext packages
    \RequirePackage{mathrsfs}% enable \mathscr for script alphabet
    \RequirePackage[cal=cm]{mathalfa}% map styles for calligraphic \mathcal and script \mathscr alphabet
\else% <xelatex> or <lualatex> call system fonts
    \RequirePackage{fontspec}% support calling system fonts
    \@ifpackagelater{fontspec}{2016/12/27}{}{%
        \PackageError{artratex}{fontspec >= 2016/12/27 is required ...}{}%
    }
    % - 字体属性：<family:rm|sf|tt> + <weight:lf|md|bf> + <shape:up|it|sl|sc> + <size>
    % - <\rmfamily,\textrm{}|\sffamily,\textsf{}|\ttfamily,\texttt{}>：字体系列 <Roman|Sans serif|Monospace>，默认 <\rmfamily>
    % - <\lfseries,\textlf{}|\mdseries,\textmd{}|\bfseries,\textbf{}>：字体粗细<light|medium|bold>，默认<\mdseries>
    % - <\upshape,\textup{}|\itshape,\textit{}|\scshape,\textsc{}|\slshape,\textsl{}>：字体形状<upright|italic|samll capital|slanted>，默认 <\upshape>
    % - 使用属性指定默认的 TeX 字体系列：<main>、<sans>、<mono>
    % - \setxxxxfont{<font>}[Path=<>,Extension=<>,UprightFont=<>,BoldFont=<>,ItalicFont=<>,BoldItalicFont=<>,SlantedFont=<>,BoldSlantedFont=<>, SmallCapsFont=<>]%
    % - 字体加载的默认设置自动为 \setmainfont 和 \setsansfont 命令添加 Ligatures=TeX 功能
    % - LuaTEX 或 XETEX 已知的字体可以通过它们的标准名称加载，因为你会大声说出它们
    % - 搜索路径中的字体可以通过文件名加载，但必须明确包含粗体和斜体变体
    % - 当字体系列同时具有倾斜和斜体形状时，可以使用类似的特征 ItalicFont 和 SlantedFont 分别指定它们
    % - 如果没有这些，倾斜的字体切换 (\textsl{},\slshape) 将默认为斜体
    % - Roman 或 Serif - 带有笔划的字体 - 用于主要内容
    % - 示例：Times New Roman、Adobe Garamond Pro
    % \setmainfont{Adobe Garamond Pro}%
    % - 额外的字体切换：{\normalfont ...}、\textnormal{...} 由于 \renewcommand*{\familydefault}{\rmdefault}
    % - 无衬线 - 没有笔划的字体 - 用于要求高可读性的标题
    % - 示例：Arial、Helvetica、Gill Sans MT、Futura
    % \setsansfont{Gill Sans MT}%
    % - 等宽字体 - 具有相同宽度的字体 - 用于编程等
    % - 示例：Rockwell、Andale Mono、Courier
    % \setmonofont {罗克韦尔}%
    % - 指定用户定义的字体系列和字体开关（如 \rmfamily、\sffamily、\ttfamily）
    % - 没有 NFSSFamily 选项，仅在添加新字体名称时才定义字体系列
    % \newfontfamily\<font-switch>{<font>}[<font features>]%
    % \newcommand{\text<font-switch>}[1]{{\<font-switch> #1}}%
    % - 文本字体：英文 <默认：计算机现代|fontspec：系统字体|其他：字体包>
    % \RequirePackage{newtxtext}% 主要字体
    % - 数学字体：<默认：计算机现代|其他：字体包<newtxmath|unicode-math>>
    % \RequirePackage[cmintegrals]{newtxmath}% 次字体，在 amsmath 和 newtxtext 包之后加载
    % \RequirePackage{mathrsfs}% 为脚本字母表启用 \mathscr
    % \RequirePackage[cal=cm]{mathalfa}% 书法 \mathcal 和脚本 \mathscr 字母表的地图样式
    \IfFontExistsTF{XITS-Regular.otf}{%
    \RequirePackage{unicode-math}% unicode 字体配置 <XITS|STIX2>
    \def\boldsymbol#1{\symbfit{#1}}% 处理过时
    \providecommand{\Vector}[1]{\symbfit{#1}}% general vectors in bold italic
    \providecommand{\unitVector}[1]{\symbfup{#1}}% unit vectors in bold roman
    \providecommand{\Matrix}[1]{\symbfup{#1}}% matrix in bold roman
    \providecommand{\unitMatrix}[1]{\symbfup{#1}}% identity matrix in bold roman
    \providecommand{\Tensor}[1]{\symbfsfup{#1}}% tensor in sans-serif bold italic
    \providecommand{\unitTensor}[1]{\symbfsfup{#1}}% identity tensor in sans-serif bold
    \setmainfont[NFSSFamily=entextrm]{XITS}[
      Extension      = .otf,
      UprightFont    = *-Regular,
      BoldFont       = *-Bold,
      ItalicFont     = *-Italic,
      BoldItalicFont = *-BoldItalic,
      Ligatures=TeX,
    ]
    \setsansfont[NFSSFamily=entextsf]{XITS}[
      Extension      = .otf,
      UprightFont    = *-Regular,
      BoldFont       = *-Bold,
      ItalicFont     = *-Italic,
      BoldItalicFont = *-BoldItalic,
      Ligatures=TeX,
    ]
    \setmonofont[NFSSFamily=entexttt]{XITS}[
      Extension      = .otf,
      UprightFont    = *-Regular,
      BoldFont       = *-Bold,
      ItalicFont     = *-Italic,
      BoldItalicFont = *-BoldItalic,
      Ligatures=TeX,
    ]
    \setmathfont{XITSMath-Regular}[
      Extension    = .otf,
      BoldFont     = XITSMath-Bold,
      Ligatures=TeX,
      StylisticSet = 1,
    ]
    \setmathfont{XITSMath-Regular}[
      Extension    = .otf,
      range={cal,bfcal},
      Ligatures=TeX,
      StylisticSet = 1,
    ]
    \setmathfont{XITSMath-Regular}[
      Extension    = .otf,
      range={scr,bfscr},
      Ligatures=TeX,
      StylisticSet = 2,
    ]
    \setmathrm{XITSMath-Regular}[
      Extension    = .otf,
      BoldFont     = XITSMath-Bold,
      Ligatures=TeX,
      StylisticSet = 1,
    ]
    \setmathsf{XITSMath-Regular}[
      Extension    = .otf,
      BoldFont     = XITSMath-Bold,
      Ligatures=TeX,
      StylisticSet = 1,
    ]
    \setmathtt{XITSMath-Regular}[
      Extension    = .otf,
      BoldFont     = XITSMath-Bold,
      Ligatures=TeX,
      StylisticSet = 1,
    ]
    }{%
    \RequirePackage{newtxtext}% 主要字体
    \RequirePackage[cmintegrals]{newtxmath}% 次字体，在 amsmath 和 newtxtext 包之后加载
    \RequirePackage{mathrsfs}% 为脚本字母表启用 \mathscr
    \RequirePackage[cal=cm]{mathalfa}% 用于书法 \mathcal 和脚本 \mathscr 字母表的地图样式
    }
    % - 文字字体：中文
    \ifartx@windows%
        \setCJKmainfont{SimSun}[AutoFakeBold=2.5,ItalicFont=KaiTi]%
        \setCJKsansfont{SimHei}[AutoFakeBold=2.5]%
        \setCJKmonofont{FangSong}%
    \else\ifartx@mac%
        \setCJKmainfont{Songti SC}[%
            UprightFont    = * Light,
            BoldFont       = * Bold,
            ItalicFont     = Kaiti SC,
            BoldItalicFont = Kaiti SC Bold,
        ]
        \setCJKsansfont{Heiti SC}[BoldFont = * Medium]%
        \setCJKmonofont{STFangsong}%
    \else\ifartx@adobe% call font from system font library
        \setCJKmainfont{AdobeSongStd-Light}[%
            AutoFakeBold=2.5,
            ItalicFont=AdobeKaitiStd-Regular,
        ]
        \setCJKsansfont{AdobeHeitiStd-Regular}[%
            AutoFakeBold=2.5,
        ]%
        \setCJKmonofont{AdobeFangsongStd-Regular}%
    \else\ifartx@none% call font from local fontdir
    % - 没有路径：i) 如果字体由没有扩展名的字符串指定，fontspec 将
    % - 将给定的字符串视为字体名称并使用系统 fontconfig 搜索字体名称
    % - 在系统字体库中；ii) 如果字体由带有扩展名的字符串指定，fontspec 将
    % - 将给定的字符串视为字体文件名并使用 kpathsea 搜索字体文件名
    % - LaTeX 分布
    % - 带路径：fontspec 将给定的字符串作为字体文件名并使用 kpathsea 来
    % - 在路径中搜索字体文件名，扩展名是可选的，但在这种情况下推荐
        \setCJKmainfont{AdobeSongStd-Light}[%
            Path=\artx@fontdir,
            Extension=.otf,
            AutoFakeBold=2.5,
            ItalicFont=AdobeKaitiStd-Regular,
        ]
        \setCJKsansfont{AdobeHeitiStd-Regular}[%
            Path=\artx@fontdir,
            Extension=.otf,
            AutoFakeBold=2.5,
        ]%
        \setCJKmonofont{AdobeFangsongStd-Regular}[%
            Path=\artx@fontdir,
            Extension=.otf,
        ]
    \fi\fi\fi\fi
\fi
% -
% -> 参考书目处理器和包
% -
\def\artxbibref{ref/refs.bib}% 参考书目文件
\def\artxbibtexnum{ref/gbt7714-numerical}% bibtex numbers bst
\def\artxbibtexauy{ref/gbt7714-author-year}% bibtex authoryear bst
\def\artxbibtexalp{alpha}% bibtex alpha bst
\def\artxbibernum{ref/gb7714-2015}% biber numbers bst
\def\artxbiberauy{ref/gb7714-2015ay}% biber authoryear bst
\def\artxbiberalp{alphabetic}% biber alpha bst
%- Bibtex 处理器 + natbib 包
\ifartx@bibtex%
    % 设置引用风格的标点和模式
    \newcommand{\bibstyle@super}{\bibpunct{[}{]}{,}{s}{,}{\textsuperscript{,}}}%
    \newcommand{\bibstyle@numbers}{\bibpunct{[}{]}{,}{n}{,}{,}}%
    \newcommand{\bibstyle@authoryear}{\bibpunct{(}{)}{;}{a}{,}{,}}%
    \newcommand{\bibstyle@alpha}{\bibpunct{[}{]}{,}{n}{,}{,}}%
    \ifartx@numbers% enable numbered citation style
        \RequirePackage[numbers,sort&compress]{natbib}% numbered citation mode
        \ifartx@super% enable superscripted citation style
            \citestyle{super}%
        \else
            \citestyle{numbers}%
        \fi
        \bibliographystyle{\artxbibtexnum}% numbered scheme
    \fi
    \ifartx@authoryear% enable author year citation style
        \RequirePackage{natbib}% author year citation mode
        \citestyle{authoryear}%
        \bibliographystyle{\artxbibtexauy}% author year scheme
    \fi
    \ifartx@alpha% enable alpha citation style
        \RequirePackage[square,comma,numbers]{natbib}% alpha citation mode
        \bibliographystyle{\artxbibtexalp}% alpha scheme
    \fi
    \providecommand*{\citetns}[2][]{% text embedded \citet in superscripted mode
        \begingroup\citestyle{numbers}\citet[#1]{#2}\endgroup%
    }
    \providecommand*{\citepns}[2][]{% text embedded \citep in superscripted mode
        \begingroup\citestyle{numbers}\citep[#1]{#2}\endgroup%
    }
\fi
% - Biber 处理器 + biblatex 包
\ifartx@biber%
    \AtEndPreamble{\RequirePackage{hyperref}}% enable biblatex detection of hyperref
    \ifartx@numbers% enable numbered citation style
        \ifartx@super% enable superscripted citation style
            \RequirePackage[backend=biber,style=\artxbibernum,mincitenames=1,maxcitenames=2]{biblatex}%
        \else
            \RequirePackage[backend=biber,style=\artxbibernum,mincitenames=1,maxcitenames=2]{biblatex}%
            \renewrobustcmd*{\citet}{\textcite}%
            \renewrobustcmd*{\citep}{\parencite}%
        \fi
    \fi
    \ifartx@authoryear% enable author year citation style
        \RequirePackage[backend=biber,style=\artxbiberauy,mincitenames=1,maxcitenames=2]{biblatex}%
            \renewrobustcmd*{\citet}{\textcite}%
            \renewrobustcmd*{\citep}{\parencite}%
    \fi
    \ifartx@alpha% enable alpha citation style
        \RequirePackage[backend=biber,style=\artxbiberalp]{biblatex}%
    \fi
    \addbibresource{\artxbibref}%
    \providecommand{\citep}[1]{\parencite{#1}}% compatibility
    \providecommand{\citet}[1]{\textcite{#1}}% compatibility
    \providecommand{\bibetal}{et al.}% compatibility
    \providecommand{\biband}{and}% compatibility
    \DefineBibliographyStrings{english}{%
        andincite         = {\biband},
        andothersincite   = {\bibetal{}},
        andincitecn       = {\biband},
        andothersincitecn = {\bibetal},
    }
\fi
% -
% -> 图形环境支持
% -
\RequirePackage{graphicx}% packages for including graphics
\RequirePackage[format=plain,hangindent=2.0em,font={small,bf},skip=8pt,labelsep=space]{caption}% options: [margin=10pt,labelfont=bf]
\RequirePackage{subcaption}% package for subfigures
\RequirePackage[list=off]{bicaption}% package for binary captions
\DeclareCaptionOption{bi-first}[]{}% 1st language
\DeclareCaptionOption{bi-second}[]{% 2nd language
    \def\tablename{Table}%
    \def\figurename{Figure}%
}
\captionsetup[bi-first]{bi-first}%
\captionsetup[bi-second]{bi-second}%
\RequirePackage[section]{placeins}% prevent floats from being moved over section
% -
% -> 页面布局和间距
% -
\ifartx@geometry% enable geometry to redefine page layout
    \RequirePackage{geometry}% page layout
    %\RequirePackage{setspace}% line spacing
\fi
\ifartx@lscape% landscape layout
    \RequirePackage{fancyhdr}% fancy headers and footers
    %- usage: \begin{landscape} [\thispagestyle{lscape}] text... \end{landscape}
    \RequirePackage{pdflscape}% landscape environment
    \RequirePackage[absolute]{textpos}% rotated page number
\fi
\ifartx@xhf% header and footer style
    \RequirePackage{fancyhdr}% fancy headers and footers
\fi
%\RequirePackage{microtype}% improves general appearance of the text
% -
% -> 颜色
% -
\ifartx@color% enable color package to use color
    %\RequirePackage{color}%
    \RequirePackage[usenames,dvipsnames,table]{xcolor}%
\fi
% -
% -> 直接用 TeX 命令绘制图形
% -
\ifartx@tikz%
    \RequirePackage{tikz}% automatically load pgf package
    \usetikzlibrary{% load libraries
        positioning,
        arrows,
        calc,
        trees
    }%
\fi
% -
% -> 复杂表
% -
\ifartx@table%
    \RequirePackage{ctable,multirow}% imports the array, tabularx, booktabs and multirow packages
\fi
% -
% -> 列表结构
% -
\ifartx@list% enable enhanced list and verbatim structures
    \RequirePackage{verbatim}% improve verbatim environment
    \RequirePackage{enumitem}% configure the enumerate environment
    \setlist[enumerate]{wide=\parindent}% only indent the first line
    \setlist[itemize]{wide=\parindent}% only indent the first line
    \setlist{nosep}% default text spacing
    \RequirePackage{listings}% source code
    \RequirePackage{algpseudocode,algorithm,algorithmicx}% algorithm
    \providecommand{\algname}{Algorithm}%
    \def\ALG@name{\algname}% rename label
\fi
% -
% -> 链接支持
% -
\AtEndPreamble{%
    \RequirePackage{hyperref}% load at last
    \hypersetup{% set hyperlinks
        pdfencoding=auto,% allows non-Latin based languages in bookmarks
        psdextra=true,% extra support for math symbols in bookmarks
        %bookmarks=true,% show bookmarks bar
        bookmarksnumbered=true,% put section numbers in bookmarks
        pdftitle={\@title},% title
        pdfauthor={\@author},% author
        pdfsubject={\@title},% subject
        %pdftoolbar=true,% show toolbar
        %pdfmenubar=true,% show menu
        pdffitwindow=false,% window fit to page when opened
        pdfstartview={FitH},% fits the width of the page to the window
        %pdfnewwindow=true,% links in new window
        %backref=true,% do bibliographical back references
        %pagebackref=true,% backreference by page number
        colorlinks=true,% false: boxed links; true: colored links
        linkcolor=black,% color of internal links
        citecolor=blue,% color of links to bibliography
        filecolor=blue,% color of file links
        urlcolor=blue,% color of external links
    }
    \ifartx@xlink% set link color to black
        \hypersetup{% set hyperlinks
            hidelinks,% remove link color and border
        }
    \fi
}
% -------------------------------------------------- --------------%
% ->> 配置命令
% -------------------------------------------------- --------------%
% -
% -> 图形的扩展名和目录
% -
% - 声明图形扩展以在包含图形时自动选择
% - 通过避免在 \includegraphics 命令中提供图形扩展，
% - 源文件可以更通用和自适应
\ifartx@xetex%
    \DeclareGraphicsExtensions{.pdf,.png,.jpg,.eps,.tif,.bmp,.gif}%
\else% <pdflatex> or <lualatex>
    \DeclareGraphicsExtensions{.pdf,.png,.jpg}%
\fi
\graphicspath{{figure/}}% search path for figures
% -
% -> 布局、空间和样式
% -
\ifartx@geometry% 启用几何图形重新定义页面布局
    \geometry{paper=a4paper,left=31.7mm,right=31.7mm,top=25.4mm,bottom=25.4mm,headheight=12pt,headsep=17.5pt,footskip=10.4mm}%
\fi
%\linespread{1.5}% 1.5 for "one and a half" line spacing, and 2.0 for "double" line spacing
%\setlength{\parskip}{0.5ex plus 0.25ex minus 0.25ex}% skip space a paragraph
\setcounter{tocdepth}{2}% depth for the table of contents
\setcounter{secnumdepth}{3}% depth for section numbering, default is 2(subsub)
% - 设置方程式、图形、表格编号
%\numberwithin{equation}{section}% set enumeration level
%\renewcommand{\theequation}{\thesection\arabic{equation}}% configure the label style
%\numberwithin{figure}{section}% set enumeration level
%\renewcommand{\thefigure}{\thesection\arabic{figure}}% configure the label style
%\numberwithin{table}{section}% set enumeration level
%\renewcommand{\thetable}{\thesection\arabic{table}}% configure the label style
% - 设置参考书目条目
\ifartx@bibtex%
    \setlength{\bibsep}{0.0ex plus 0.2ex minus 0.2ex}% set distance between entries
\fi
\ifartx@biber%
    %\setlength\bibitemsep{0.5\baselineskip}% set distance between entries
    \setlength\bibitemsep{0.0ex plus 0.2ex minus 0.2ex}% set distance between entrie
\fi
\renewcommand*{\bibfont}{\small}% set font size for bibliography
% -
% -> 页眉页脚样式
% -
% - Latex 中的页面样式是指文档的页眉和页脚。
% - 这些页眉/页脚通常包含文档标题、章节
% - 或章节号/名称和页码。
% - 配置花式风格
\ifartx@xhf% user defined header and footer style
    \pagestyle{fancy}%
    % - 在 LaTeX 中自定义页眉和页脚是一个两阶段的过程
    % - 1) \chapter|section call \chapter|sectionmark 调用 \markboth|right 来定义 \left|rightmark
    % - 但是 \chapter*|section* 不调用 \chapter|sectionmark，则需要手动调用 \markboth|right 来更新 \left|rightmark
    % - \markboth{这里设置 \leftmark 为章节标题}{这里设置 \rightmark 为章节标题}
    % - 2) 在页眉/页脚定义中，\left|rightmark 表示当前章节标题
    % - 标题的原始章节标记和节标记
    % \renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{\chaptername\ \thechapter.\ #1}}{}}%
    % \renewcommand{\sectionmark}[1]{\markright{\thesection\ #1}}%
    % - 重新定义以将标记设置为实际名称
    % \renewcommand{\chaptermark}[1]{\markboth{\MakeUppercase{#1}}{}}%
    % \renewcommand{\sectionmark}[1]{\markright{\MakeUppercase{#1}}{}}%
    % - 停用大写效果
    \renewcommand{\MakeUppercase}[1]{#1}%
    % - 为不同的部分定义不同类型的页眉和页脚
    \fancypagestyle{frontmatterstyle}{% style for frontmatter
        \fancyhf{}% clear fields
        % \fancyhead[C]{\footnotesize \ifnumodd{\value{page}}{\leftmark}{\@title}}% structure elements
        \fancyfoot[C]{\footnotesize \thepage}% page number
        \renewcommand{\headrulewidth}{0.8pt}% header rule
        \renewcommand{\footrulewidth}{0pt}% footer rule
    }
    \fancypagestyle{mainmatterstyle}{% style for mainmatter
        \fancyhf{}% clear fields
        % \fancyhead[C]{\footnotesize \ifnumodd{\value{page}}{\leftmark}{\@title}}% structure elements
        \fancyfoot[C]{\footnotesize \ifnumodd{\value{page}}{\hspace*{\fill}\thepage}{\thepage\hspace*{\fill}}}% page number
        \renewcommand{\headrulewidth}{0.8pt}% header rule
        \renewcommand{\footrulewidth}{0pt}% footer rule
    }
    \fancypagestyle{backmatterstyle}{% header and footer style for backmatter
        \fancyhf{}% clear fields
        % \fancyhead[C]{\footnotesize \ifnumodd{\value{page}}{\leftmark}{\@title}}% structure elements
        \fancyfoot[C]{\footnotesize \ifnumodd{\value{page}}{\hspace*{\fill}\thepage}{\thepage\hspace*{\fill}}}% page number
        \renewcommand{\headrulewidth}{0.8pt}% header rule
        \renewcommand{\footrulewidth}{0pt}% footer rule
    }
    % - 重新定义 \frontmatter 以包含更改
    \providecommand{\frontmatter}{}% compatibility for non-book classes
    \let\artxfrontmatter\frontmatter%
    \renewcommand{\frontmatter}{%
        \artxfrontmatter%
        \pagestyle{frontmatterstyle}%
    }
    % - 重新定义 \mainmatter 以包含更改
    \providecommand{\mainmatter}{}% compatibility for non-book classes
    \let\artxmainmatter\mainmatter%
    \renewcommand{\mainmatter}{%
        \artxmainmatter%
        \pagestyle{mainmatterstyle}%
    }
    % - 重新定义 \backmatter 以包含更改
    \providecommand{\backmatter}{}% compatibility for non-book classes
    \let\artxbackmatter\backmatter%
    \renewcommand{\backmatter}{%
        \artxbackmatter%
        \pagestyle{backmatterstyle}%
    }
    % - 一些 Latex 命令，如 \chapter，使用 \thispagestyle 命令
    % - 自动切换到普通页面样式，从而忽略
    % - 当前有效的页面样式。要自定义此类页面，您必须
    % - 重新定义普通页面样式。如果你想要简单的风格继承
    % - 当前样式，在普通样式定义中注释所有行。
    \fancypagestyle{plain}{%
        %\fancyhf{}% clear fields
        %\renewcommand{\headrulewidth}{0pt}% header rule
        %\renewcommand{\footrulewidth}{0pt}% footer rule
    }
    \fancypagestyle{noheaderstyle}{% header and footer style for no header
        \fancyhf{}% clear fields
        % \fancyhead[C]{\footnotesize \ifnumodd{\value{page}}{\leftmark}{\@title}}% structure elements
        \fancyfoot[C]{\footnotesize \ifnumodd{\value{page}}{\hspace*{\fill}\thepage}{\thepage\hspace*{\fill}}}% page number
        \renewcommand{\headrulewidth}{0pt}% header rule
        \renewcommand{\footrulewidth}{0pt}% footer rule
    }
\fi
% -
% -> 配置横向环境
% -
\ifartx@lscape%
\fancypagestyle{lscape}{% landscape layout style
    \fancyhf{}% clear fields
    \fancyhead[C]{%
        \begin{textblock}{1.0}[0.5,0.5](0.08,0.5)%
            \rotatebox{90}{%
                \footnotesize \ifnumodd{\value{page}}{\leftmark}{\@title}%
            }%
        \end{textblock}%
        \begin{textblock}{1.0}[0.5,0.5](0.08,0.5)%
            \rotatebox{90}{%
                \rule[-14pt]{\textwidth}{0.8pt}%
            }%
        \end{textblock}%
    }%
    \fancyfoot[C]{%
        \begin{textblock}{1.0}[0.5,0.5](0.92,0.5)
            \rotatebox{90}{%
                \footnotesize \ifnumodd{\value{page}}{\hspace*{\fill}\thepage}{\thepage\hspace*{\fill}}%
            }%
        \end{textblock}%
    }%
    % - textpos: \begin{textblock}{<blockwidth>}[<ho>,<vo>](<hpos>,<vpos>) 文本... \end{textblock}
    % - 绝对坐标的原点是页面的左上角
    % - 文本将设置在 <blockwidth> 模块宽度的框内并放置在页面上
    % - 块的点 [<ho>,<vo>] 在页面的位置 (<hpos>,<vpos>)
    % - [<ho>,<vo>] 是文本框宽度和高度的分数，并指定
    % - 文本框的参考点，[0,0]：左上角；[0.5,0.5]：中间；[0,1]：左下角
    % - [<hpos>,<vpos>] 是页面宽度和高度的分数，并指定
    % - 页面上的位置点，[0,0]：左上角；[0.5,0.5]：中间；[0,1]：左下角
    % - 通过模块设置 <blockwidth>、<hpos> 参数的单位
    \setlength{\TPHorizModule}{\paperwidth}%
    % - 通过模块设置 <vpos> 参数的单位
    \setlength{\TPVertModule}{\paperheight}%
    %- \rule[raise]{width}{thickness}
    %- \rotatebox[origin=c]{angle}{text}
    \renewcommand{\headrulewidth}{0pt}% header rule
    \renewcommand{\footrulewidth}{0pt}% footer rule
}
\fi
% -
% -> 配置列表环境
% -
\ifartx@list% enable enhanced list
    \definecolor{artxgreen}{rgb}{0,0.6,0}
    \definecolor{artxgray}{rgb}{0.5,0.5,0.5}
    \definecolor{artxmauve}{rgb}{0.58,0,0.82}
    \lstset{%
        numberbychapter=false,% numbered sequentially or by chapter
        backgroundcolor=\color{white},% background color;
        basicstyle=\scriptsize,% font size for code
        breakatwhitespace=false,% sets if automatic breaks should only happen at whitespace
        breaklines=true,% sets automatic line breaking
        captionpos=b,% caption-position to bottom
        commentstyle=\color{artxgreen},% comment style
        %deletekeywords={...},% delete keywords from the given language
        frame=single,% adds a frame around the code
        keepspaces=true,% keeps spaces in text for keeping indentation of code
        keywordstyle=\color{blue},% keyword style
        %otherkeywords={*,...},% add more keywords to the set
        numbers=left,% where to put the line-numbers; possible values are (none, left, right)
        numbersep=5pt,% how far the line-numbers are from the code
        numberstyle=\tiny\color{artxgray},% the style that is used for the line-numbers
        rulecolor=\color{black},% if not set, the frame-color may be changed on line-breaks
        showspaces=false,% show spaces everywhere adding particular underscores;
        showstringspaces=false,% underline spaces within strings only
        showtabs=false,% show tabs within strings adding particular underscores
        stepnumber=2,% the step between two line-numbers. If it's 1, each line will be numbered
        stringstyle=\color{artxmauve},% string literal style
        tabsize=2,% sets default tabsize to 2 spaces
        title=\lstname% show the filename of files
    }
\fi
% -
% -> 页面背景
% -
\ifartx@background%
    \definecolor{backgroundcolor}{rgb}{0.85,0.85,0.85}%
    \pagecolor{backgroundcolor}% background color
\fi
%---------------------------------------------------------------------------%
\endinput

